---
import doAuth from "../lib/actions/do-auth.js";

const { url: { searchParams }, redirect } = Astro;

const { isAuthed, getAuthUrl } = await doAuth(Astro);

if (isAuthed) {
  const { isLoggedOut } = await doAuth(Astro, { action: "logout" });
  if (isLoggedOut) return redirect(searchParams.get("return_to") || "/");
} else {
  return redirect(getAuthUrl({ path: "/logout" }));
}
---
